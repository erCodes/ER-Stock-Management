<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ER-Stock Management</title>
    <base href="/" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script type="text/javascript" src="C:\Users\eetur\source\repos\ER-Stock Management\CommonFunctions.js"></script>
    <link href="C:\Users\eetur\source\repos\ER-Stock Management\Default.css" rel="stylesheet" />
    <link href="C:\Users\eetur\source\repos\ER-Stock Management\Darkmode.css" rel="stylesheet" />
</head>
<body>
    <h3 id="Title"></h3>
    <div class="col-auto py-3">
        <button type="button" class="btn-secondary" onclick="Redirect('')">Main page</button>
    </div>
    <div class="col-6 text-end d-inline-block">
        <img class="flags p-2" src="finnish.png" alt="FI" />
        <img class="flags p-2" src="english.png" alt="EN" />
        <img class="p-2" id="pagecolor" src="darkmode.png" alt="Light/Dark" />
    </div>

    <h3 id="Message"></h3>

    <div class="container">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th scope="col">Products Name</th>
                    <th scope="col">Amount in stock</th>
                    <th scope="col">Categories</th>
                    <th scope="col">Modified on (UTC)</th>
                </tr>
            </thead>
            <tbody id="table">
            </tbody>
        </table>
    </div>

    <script>
        let storeAndData;
        const categories;
        let counter = 0;

        document.addEventListener('DOMContentLoaded', function () {
            storeAndData = localStorage.getItem("StoreAndProducts");
            GetAllCategories();
            storeAndData['products'].forEach((element, index) => CreateProductInfo(element, index));
            CreateProductInfo();
        });

        function CreateProductInfo(element, index) {
            const tBody = document.getElementById('table');
            const row = document.createElement('tr');
            const rowId = 'product' + index;
            row.id = rowId;
            tBody.appendChild(row);

            const modifyCell = document.createElement('td');
            const modifyCellId = 'ModifyCell' + index;
            modifyCell.id = modifyCellId;
            row.appendChild(modifyCell);

            const modifyButton = document.createElement('button');
            modifyButton.type = 'button';
            modifyButton.className = 'btn-primary';
            modifyButton.onclick = () => { ModifyProduct(element) };
            modifyCell.appendChild(modifyButton);

            const productName = document.createElement('input');
            productName.type = 'text';
            productName.id = "ProductName" + index;
            productName.value = element['name'];
            modifyCell.appendChild(productName);

            const amountCell = document.createElement('td');
            row.appendChild(amountCell);

            const amount = document.createElement('input');
            amount.type = 'text';
            amount.id = "Amount" + index;
            amount.value = element['instock'];
            amountCell.appendChild(amount);

            const categoryCell = document.createElement('td');
            row.appendChild(categoryCell);

            for (const entry of categories) {
                var catLabel = document.createElement("label");
                catLabel.setAttribute("for", counter);
                catLabel.textContent = entry['name'];
                categoryCell.appendChild(catLabel);

                var catCheckbox = document.createElement("input");
                catCheckbox.type = "checkbox";
                catCheckbox.className = "form-check-input";
                catCheckbox.id = counter;
                catCheckbox.value = entry;
                const found = element['categoryids'].find(entry['id']);
                if (found) {
                    catCheckbox.checked = true;
                }

                catLabel.appendChild(catCheckbox);
                counter++;
            }

            const timestampCell = document.createElement('td');
            timestampCell.textContent = element['timestamp'];
            row.appendChild(timestampCell);
        }


        function GetAllCategories() {
            fetch('https://localhost:7233/GetAllCategories')
                .then(data => {
                    if (!data.ok) {
                        document.getElementById('Message').innerHTML = 'Failed to get categories. Please try again later.';
                        throw new Error("Promise chain cancelled");
                    }
                    return data.json();
                })
                .then(data => {
                    console.log(data)
                    if (!data) {
                        document.getElementById('Message').innerHTML = 'There are no categories. Please add new one to continue';
                        throw new Error("Promise chain cancelled");
                    }
                    else {
                        categories = data;
                    }

                })
                .catch((error) => {
                    console.error(error)
                });
        }

        //function CreateCategoryCell(element, index) {
        //    console.log(element, index);
        //    const row = document.getElementById('categories');
        //    const cell = document.createElement('tr');
        //    const cellId = 'category' + index;
        //    cell.id = cellId;
        //    row.appendChild(cell);

        //    const createdCell = document.getElementById(cellId);

        //    const inputId = cellId + "Input";
        //    var input = document.createElement("input");
        //    input.type = "text";
        //    input.value = element["name"];
        //    input.placeholder = element["name"];
        //    input.id = inputId;
        //    createdCell.appendChild(input);

        //    var submit = document.createElement("input");
        //    submit.type = "submit";
        //    submit.className = "btn btn-primary";
        //    submit.value = "Modify";
        //    console.log("IdNumero:", inputId);
        //    submit.onclick = () => { Modify(element, inputId) }
        //    createdCell.appendChild(submit);

        //    const boxId = cellId + "Delete";

        //    var deleteLabel = document.createElement("label");
        //    deleteLabel.setAttribute("for", boxId);
        //    deleteLabel.textContent = "Delete category?"
        //    createdCell.appendChild(deleteLabel);

        //    var deleteCheckbox = document.createElement("input");
        //    deleteCheckbox.type = "checkbox";
        //    deleteCheckbox.className = "form-check-input";
        //    deleteCheckbox.id = boxId;
        //    deleteLabel.appendChild(deleteCheckbox);


        //    var deleteButton = document.createElement("input");
        //    deleteButton.type = "button";
        //    deleteButton.className = "btn btn-danger";
        //    deleteButton.value = "Delete";
        //    deleteButton.onclick = () => { Delete(element["id"], boxId) }
        //    createdCell.appendChild(deleteButton);
        //}

        function ModifyProduct() {

        }
    </script>
</body>
</html>